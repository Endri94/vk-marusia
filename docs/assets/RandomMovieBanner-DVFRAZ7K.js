import{p as N,j as e,r as s,A as y,m as j,c as C,f as M,k as g,q as E,s as I,h as L}from"./index-YxfBBWVY.js";var H=N();const T="data:image/svg+xml,%3csvg%20width='20'%20height='20'%20viewBox='0%200%2020%2020'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M10%202C12.7486%202%2015.1749%203.38626%2016.6156%205.5H14V7.5H20V1.5H18V3.99936C16.1762%201.57166%2013.2724%200%2010%200C4.47715%200%200%204.47715%200%2010H2C2%205.58172%205.58172%202%2010%202ZM18%2010C18%2014.4183%2014.4183%2018%2010%2018C7.25144%2018%204.82508%2016.6137%203.38443%2014.5H6V12.5H0V18.5H2V16.0006C3.82381%2018.4283%206.72764%2020%2010%2020C15.5228%2020%2020%2015.5228%2020%2010H18Z'%20fill='white'/%3e%3c/svg%3e",k=({children:a,text:d})=>e.jsxs("div",{className:"tooltip-container",children:[a,e.jsx("span",{className:"tooltip-text",children:d})]}),F=({youtubeId:a,title:d,onClose:n})=>{const l=s.useRef(null),i=s.useRef(null),[o,u]=s.useState(!1),[h,b]=s.useState(!0),[p,x]=s.useState(!0),m=s.useCallback(()=>{if(!l.current)return;const t=o?"playVideo":"pauseVideo";l.current.contentWindow?.postMessage(JSON.stringify({event:"command",func:t,args:[]}),"*"),u(!o)},[o]),_=()=>{const t=i.current;t&&(document.fullscreenElement?document.exitFullscreen?.():t.requestFullscreen?.())};return s.useEffect(()=>{const t=r=>{r.key==="Escape"&&n(),r.key===" "&&(r.preventDefault(),m())};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[n,m]),s.useEffect(()=>{let t;const r=()=>{b(!0),clearTimeout(t),t=setTimeout(()=>{b(!1)},2e3)};return window.addEventListener("mousemove",r),()=>{clearTimeout(t),window.removeEventListener("mousemove",r)}},[]),s.useEffect(()=>{const t=setInterval(()=>{l.current&&l.current.contentWindow?.postMessage(JSON.stringify({event:"command",func:"setOption",args:["showinfo",0]}),"*")},2e3);return()=>clearInterval(t)},[]),H.createPortal(e.jsx(y,{children:e.jsx(j.div,{className:"trailer-modal__overlay",onClick:n,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsxs(j.div,{className:"trailer-modal__wrapper",role:"dialog",initial:{scale:.96,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},transition:{duration:.3,ease:"easeOut"},onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{ref:i,className:"trailer-modal__container",onClick:t=>{t.stopPropagation(),m()},children:[p&&e.jsx("div",{className:"trailer-modal__loader",children:e.jsxs("div",{className:"curve-bars-spinner",children:[e.jsx("div",{}),e.jsx("div",{className:"reverse"}),e.jsx("div",{}),e.jsx("div",{className:"reverse"})]})}),e.jsx("iframe",{ref:l,className:"trailer-modal__iframe",src:`https://www.youtube.com/embed/${a}?autoplay=1&enablejsapi=1&modestbranding=1&rel=0&controls=0&showinfo=0&disablekb=1&fs=0&iv_load_policy=3&fullscreen=1`,allow:"autoplay; fullscreen",onLoad:()=>x(!1),loading:"lazy",allowFullScreen:!0}),e.jsxs("div",{className:`trailer-modal__controls ${h?"visible":""}`,children:[e.jsx("div",{className:"trailer-modal__buttons",children:e.jsx("div",{className:"trailer-modal__play-button",children:o?"▶":"⏸"})}),e.jsx("div",{className:"trailer-modal__title-overlay",children:d})]})]}),e.jsx("button",{className:"trailer-modal__close-btn",title:"Закрыть",onClick:t=>{t.stopPropagation(),n()},"aria-label":"Закрыть трейлер",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:[e.jsx("path",{d:"M18 6L6 18",stroke:"black",strokeWidth:"2"}),e.jsx("path",{d:"M6 6L18 18",stroke:"black",strokeWidth:"2"})]})}),e.jsx("button",{className:"trailer-modal__fullscreen-btn",title:"На весь экран",onClick:t=>{t.stopPropagation(),_()},"aria-label":"На весь экран",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M8 3H5a2 2 0 0 0-2 2v3"}),e.jsx("path",{d:"M16 3h3a2 2 0 0 1 2 2v3"}),e.jsx("path",{d:"M8 21H5a2 2 0 0 1-2-2v-3"}),e.jsx("path",{d:"M16 21h3a2 2 0 0 0 2-2v-3"})]})})]})})}),document.body)},P=a=>a?a<60?`${a} мин`:`${Math.floor(a/60)} ч ${a%60} мин`:"—",R=({movie:a,onRandomize:d,hideRandomizeButton:n})=>{const l=C(),{user:i,openAuthModal:o}=M(),[u,h]=s.useState(!1),[b,p]=s.useState(!1),x=s.useCallback(c=>{const f=c.currentTarget;f.src=g,f.onerror=null},[]);s.useEffect(()=>{let c=!0;return(async()=>{if(!i){c&&h(!1);return}try{const v=await L();c&&h(v.some(w=>w.id===a.id))}catch(v){console.error("Ошибка при проверке избранного:",v)}})(),()=>{c=!1}},[a.id,i]);const m=s.useMemo(()=>a.posterUrl||a.backdropUrl||g,[a.posterUrl,a.backdropUrl]),_=s.useCallback(async()=>{if(!i){o();return}try{await E(a.id),h(!0),console.log("Фильм добавлен в избранное")}catch(c){console.error("Ошибка при добавлении в избранное:",c)}},[i,o,a.id]),t=s.useCallback(()=>p(!0),[]),r=s.useCallback(()=>p(!1),[]);return e.jsxs("section",{className:"banner","aria-label":`Информация о фильме ${a.title}`,children:[e.jsxs("div",{className:"banner__content",children:[e.jsxs("div",{className:"banner__info",children:[e.jsxs("div",{className:"banner__meta",children:[e.jsx(I,{rating:a.tmdbRating}),e.jsx("span",{className:"banner__meta-item",children:a.releaseYear}),e.jsx("span",{className:"banner__meta-item",children:a.genres?.join(", ")||"Жанр неизвестен"}),e.jsx("span",{className:"banner__meta-item",children:P(a.runtime)})]}),e.jsx("h1",{className:"banner__title",children:a.title}),a.plot&&e.jsx("p",{className:"banner__description",children:a.plot}),e.jsxs("div",{className:"banner__buttons",children:[e.jsx("button",{className:"banner__btn banner__btn--primary",onClick:t,children:"Трейлер"}),!n&&e.jsx("button",{className:"banner__btn banner__btn--secondary",onClick:()=>l(`/movie/${a.id}`),children:"О фильме"}),e.jsx(k,{text:u?"Уже в избранном":"Добавить в избранное",children:e.jsx("button",{className:`banner__btn banner__btn--icon banner__btn--favorite ${u?"active":""}`,onClick:_,"aria-label":"Добавить в избранное",disabled:u,children:e.jsx("svg",{className:"heart-icon",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M12 21.35L10.55 20.03C5.4 15.36 2 12.28 2 8.5C2 5.42 4.42 3 7.5 3C9.24 3 10.91 3.81 12 5.09C13.09 3.81 14.76 3 16.5 3C19.58 3 22 5.42 22 8.5C22 12.28 18.6 15.36 13.45 20.03L12 21.35Z",fill:"currentColor",stroke:"none",strokeWidth:"1.5"})})})}),!n&&d&&e.jsx(k,{text:"Показать другой фильм",children:e.jsx("button",{className:"banner__btn banner__btn--icon banner__btn--random",onClick:d,"aria-label":"Показать другой случайный фильм",children:e.jsx("img",{src:T,alt:"","aria-hidden":"true"})})})]})]}),e.jsx("div",{className:"banner__image",children:e.jsx("img",{src:m,alt:`Постер фильма "${a.title}"`,onError:x,loading:"lazy",decoding:"async"})})]}),b&&e.jsx(F,{youtubeId:a.trailerYouTubeId,title:a.title,onClose:r})]})};export{R};
